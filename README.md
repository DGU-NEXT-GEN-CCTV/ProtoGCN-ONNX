# ProtoGCN-ONNX

์ด ์์ฅ์๋ ํ์ต๋ ProtoGCN ๋ชจ๋ธ์ ONNX ํ์ผ๋ก ๋ณํํ๊ธฐ ์ํ ์ฝ๋๋ฅผ ์๊ณตํฉ๋๋ค.

### Note

๋ชจ๋ ํ์คํธ๋ ๋ค์ ํ๊ฒฝ์์ ์งํ๋์์ต๋๋ค. ์ผ๋ถ ํ๊ฒฝ์์๋ ๋ฒ์ ํธํ์ฑ ํ์ธ์ด ํ์ํ ์ ์์ต๋๋ค.

    CPU: Intel(R) Core(TM) i9-13900KF
    GPU: Nvidia GeForce RTX 4090, CUDA 12.1
    OS: Ubuntu 24.04 LTS
    Conda: 25.5.1

## Installation

์ด ์์ฅ์์์ ์๊ณตํ๋ ๋ชจ๋์ ์คํํ๊ธฐ ์ํด Conda ๊ธฐ๋ฐ ํ๊ฒฝ์ ๊ตฌ์ฑํฉ๋๋ค.

๋ง์ฝ, Conda๊ฐ ์ค์น๋์ด ์์ง ์๋ค๋ฉด ์๋ ๋งํฌ์ ์์ํ์ฌ ์ค์น ํ ๋จ๊ณ๋ฅผ ์งํํฉ๋๋ค.

[๐ ์๋์ฝ๋ค ๋ค์ด๋ก๋](https://www.anaconda.com/download/success) ๋๋ [๐ ๋ฏธ๋์ฝ๋ค ๋ค์ด๋ก๋](https://www.anaconda.com/docs/getting-started/miniconda/main)

**Step 1**. ์์ฅ์ ๋ณต์

```bash
git clone https://github.com/DGU-NEXT-GEN-CCTV/ProtoGCN-ONNX
cd ProtoGCN-ONNX

```

**Step 2**. Conda ๊ฐ์ํ๊ฒฝ ์์ฑ ๋ฐ ํ์ฑํ

```bash
conda env create -f protogcn-onnx.yaml
conda activate protogcn-onnx
```

**Step 3**. ๋ผ์ด๋ธ๋ฌ๋ฆฌ ์ค์น

```bash
pip install -e .
```

## Preparation

> ๋ณํ ๊ณผ์์ ์งํํ๊ธฐ์ํด ์ฌ์ ํ์ต๋ ProtoGCN์ ์ค์ ๋ฐ ๊ฐ์ค์น๊ฐ ํ์ํฉ๋๋ค.

**์ค์ ํ์ผ ๊ฒฝ๋ก**: `{repository_root}/configs/{dataset}/{method}.py`

**๊ฐ์ค์น ํ์ผ ๊ฒฝ๋ก**: `{repository_root}/checkpoints/{checkpoint}.pth`

## Convert

ONNX ํ์ผ์ ๋ณํํ๊ธฐ ์ํด convert_to_onnx.py์ 91-93๋ฒ ์ค์ ๊ฐ์ ์ฌ์ฉ์์ ํ๊ฒฝ์ ๋ง๊ฒ ์์ํฉ๋๋ค.

```python
    ...(์๋ต)...

# ์ถ์ฒ์
91  MODEL_NAME = "protogcn_{dataset}"
92  CONFIG_PATH = 'configs/{dataset}/j.py'
93  CHECKPOINT_PATH = 'checkpoints/{checkpoint}.pth'

...(์๋ต)...
```

ONNX ๋ณํ์ ์ํด ์๋ ๋ช๋น์ด๋ฅผ ์คํํฉ๋๋ค.

```bash
python convert_to_onnx.py
```

๋ณํ์ ์ฑ๊ณตํ๋ค๋ฉด `{repository_root}/onnx_models/{model_name}`์ด ์์ฑ๋ฉ๋๋ค.

```bash
.
โโโ onnx_models # ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท ์ค๋์ค ๋ชจ๋ธ ๋๋ํ๋ฆฌ
    โโโ {model_name} # ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท ๋ณํ๋ ์ค๋์ค ๋ชจ๋ธ
        โโโ 1 # ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท ๋ฒ์ ๋๋ํ๋ฆฌ (๊ธฐ๋ณธ๊ฐ 1)
        โ   โโโ model.onnx # ยทยทยทยทยทยทยทยทยทยทยทยท 1 ๋ฒ์ ONNX ๋ชจ๋ธ
        โโโ config.pbtxt # ยทยทยทยทยทยทยทยทยทยทยทยทยทยท ONNX ๋ชจ๋ธ ์/์ถ๋ฅ ์ค์ ํ์ผ
```

## Validate

๋ณํ๋ ONNX ๋ชจ๋ธ์ ์ํจ์ฑ์ ํ๊ฐํ๊ธฐ ์ํด validate_onnx.py์ 48๋ฒ ์ค ๊ฐ์ ์ฌ์ฉ์์ ํ๊ฒฝ์ ๋ง๊ฒ ์์ํฉ๋๋ค.

```python
    ...(์๋ต)...

48  MODEL_PATH = 'onnx_models/{model_name}/1/model.onnx'

    ...(์๋ต)...
```
์ํจ์ฑ์ ํ๊ฐ๋ฅผ ์ํด ์๋ ๋ช๋น์ด๋ฅผ ์คํํฉ๋๋ค.
```bash
python validate_onnx.py
```

์ํจ์ฑ ํ๊ฐ๋ 2๋จ๊ณ๋ก ์งํ๋๋ฉฐ ์ฒซ๋ฒ์งธ๋ CPU ์ธ์์์ ์ถ๋ก, ๋๋ฒ์งธ๋ GPU ์ธ์์์ ์ถ๋ก์ผ๋ก ๊ตฌ์ฑ๋์ด ์์ต๋๋ค.

๋ค๋ง, ์ด ์งํ๋ CUDA ๋ฑ ํ๊ฒฝ ์ค์์ผ๋ก ์ธํด ๋ชจ๋ธ์ ๋ฌธ์๊ฐ ์์์๋ ์ค๋ฅ๊ฐ ๋ฐ์ํ ์ ์์ต๋๋ค.

> Note. ๋ชจ๋ธ ๋ณํ์ ์ฌ๊ฐํ ๋ฌธ์๊ฐ ๋ฐ์ํ์ง ์์๋ค๋ฉด, ์ผ๋ฐ์์ผ๋ก CPU ์ธ์์์ ์์์์ผ๋ก ๋์ํฉ๋๋ค.

## ETC.

